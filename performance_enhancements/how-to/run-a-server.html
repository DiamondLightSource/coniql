<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Run a server &mdash; coniql 0.4.dev65+gb363e90 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/coniql-favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Why GraphQL?" href="../explanations/why-graphql.html" />
    <link rel="prev" title="Installation" href="../tutorials/installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: rgb(7, 43, 93)" >

          
          
          <a href="../index.html" class="icon icon-home">
            coniql
              <img src="../_static/coniql-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                master
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Run a server</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#running-a-server">Running a server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-a-channel">Getting a channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#subscribing-to-a-channel">Subscribing to a Channel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sim-plugin">Sim Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ca-plugin">CA Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pva-plugin">PVA Plugin</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanations/why-graphql.html">Why GraphQL?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/benchmark.html">Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/DiamondLightSource/coniql/releases">Releases</a></li>
<li class="toctree-l1"><a class="reference external" href="genindex.html#http://">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: rgb(7, 43, 93)" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">coniql</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Run a server</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/how-to/run-a-server.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="run-a-server">
<h1>Run a server<a class="headerlink" href="#run-a-server" title="Permalink to this heading"></a></h1>
<p>Coniql exposes an interface to Channels. A Channel maps to a single
value, with timeStamp, status information, and display level metadata.
Channels can be backed by different data stores, provided via a plugin
interface.</p>
<p>For example:</p>
<img alt="../_images/concrete-device-layer.svg" src="../_images/concrete-device-layer.svg" /><section id="running-a-server">
<h2>Running a server<a class="headerlink" href="#running-a-server" title="Permalink to this heading"></a></h2>
<p>You can run up a simulation server like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipenv</span> <span class="n">run</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">coniql</span>
</pre></div>
</div>
<p>Then you can test the connection with the graphiql interface:</p>
<p><a class="reference external" href="http://localhost:8080/graphiql">http://localhost:8080/graphiql</a></p>
<p>You can type in queries, pressing Ctrl + space to autocomplete. Below are some examples to try.</p>
<section id="getting-a-channel">
<h3>Getting a channel<a class="headerlink" href="#getting-a-channel" title="Permalink to this heading"></a></h3>
<p>A query like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="p">{</span>
  <span class="n">getChannel</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;ssim://sine&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="nb">float</span>
    <span class="p">}</span>
    <span class="n">time</span> <span class="p">{</span>
      <span class="n">datetime</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Will ask for the current value of the given Channel, selecting the value as a
float, and the time as a datetime. It returns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;getChannel&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;float&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">4.755282581475768</span>
      <span class="p">},</span>
      <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-06-12T13:10:39.875753&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first part of the id is the protocol to get the Channel from, and the
second part is the channel name. See the sections on plugins below for
details.</p>
</section>
<section id="subscribing-to-a-channel">
<h3>Subscribing to a Channel<a class="headerlink" href="#subscribing-to-a-channel" title="Permalink to this heading"></a></h3>
<p>To get updates whenever a Channel changes, you can use subscribeChannel. This returns
Channel objects with non-changing top level fields set to null. For example, if we
ask for the value, status and display of the same Channel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subscription</span> <span class="p">{</span>
  <span class="n">subscribeChannel</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;ssim://sine&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="n">string</span>
    <span class="p">}</span>
    <span class="n">status</span> <span class="p">{</span>
      <span class="n">quality</span>
    <span class="p">}</span>
    <span class="n">display</span> <span class="p">{</span>
      <span class="n">description</span>
      <span class="n">precision</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first update will be the same as a get:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;subscribeChannel&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;2.93893&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;quality&quot;</span><span class="p">:</span> <span class="s2">&quot;VALID&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;display&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;A Sine value generator&quot;</span><span class="p">,</span>
      <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="mi">5</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>While subsequent updates will show a null status and display to indicate they have not changed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;subscribeChannel&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;string&quot;</span><span class="p">:</span> <span class="s2">&quot;-0.00000&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
    <span class="s2">&quot;display&quot;</span><span class="p">:</span> <span class="n">null</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can explore the graphiql interface, using Ctrl + . to autocomplete, and
using the documentation explorer on the right to see what else you can do.</p>
</section>
</section>
<section id="sim-plugin">
<h2>Sim Plugin<a class="headerlink" href="#sim-plugin" title="Permalink to this heading"></a></h2>
<p>The sim plugin provides a number of channels that accept keyword args. For a
channel <code class="docutils literal notranslate"><span class="pre">channel</span></code> which takes up to 3 args, the allowed combinations are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssim</span><span class="p">:</span><span class="o">//</span><span class="n">channel</span>
<span class="n">ssim</span><span class="p">:</span><span class="o">//</span><span class="n">channel</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span>
<span class="n">ssim</span><span class="p">:</span><span class="o">//</span><span class="n">channel</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
<span class="n">ssim</span><span class="p">:</span><span class="o">//</span><span class="n">channel</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">)</span>
</pre></div>
</div>
<p>Any unspecified arguments are defaulted.</p>
<p>Available channels:</p>
<ul class="simple">
<li><p>ssim://sine(min_value, max_value, steps, update_seconds, warning_percent, alarm_percent)</p></li>
<li><p>ssim://sinewave(period_seconds, sample_wavelength, size, update_seconds, min_value, max_value, warning_percent, alarm_percent)</p></li>
</ul>
</section>
<section id="ca-plugin">
<h2>CA Plugin<a class="headerlink" href="#ca-plugin" title="Permalink to this heading"></a></h2>
<p>Coniql can provide values of Channel Access. To try this out, point it at some
running PVs on Diamond’s network. If you need a softIoc, you can run one up
using the epicscorelibs Python package that is a dependency of coniql. Inside
the coniql directory type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pipenv run python -m epicscorelibs.ioc -m P=$(hostname -s): -d tests/soft_records.db
</pre></div>
</div>
<p>This will then let you get the current values of the PVs in that database file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="p">{</span>
  <span class="n">getChannel</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;ca://pc0105:longout&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="n">string</span><span class="p">(</span><span class="n">units</span><span class="p">:</span> <span class="n">true</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can also put to a PV:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mutation</span> <span class="p">{</span>
  <span class="n">putChannel</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s2">&quot;ca://pc0105:longout&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s2">&quot;45&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">value</span> <span class="p">{</span>
      <span class="n">string</span><span class="p">(</span><span class="n">units</span><span class="p">:</span> <span class="n">true</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="pva-plugin">
<h2>PVA Plugin<a class="headerlink" href="#pva-plugin" title="Permalink to this heading"></a></h2>
<p>Coniql can also provide its values over pvAccess. To try this out you will need a
working installation of <a class="reference external" href="https://epics.anl.gov/base/R7-0/index.php">EPICS 7</a>. You can
then start a soft IOC, or add the PVA plugin to IOCs to expose PVs. The PVs work
like CA, but have the prefix <code class="docutils literal notranslate"><span class="pre">pva://</span></code></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../tutorials/installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../explanations/why-graphql.html" class="btn btn-neutral float-right" title="Why GraphQL?" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
   
  <div id="other-versions-div" class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions" style="visibility: hidden">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Other Versions</span>
      master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl id="other-versions-dl"/>
    </div>
  </div>
  <script>
    function addVersion(name) {
      var dd = document.createElement("dd");
      var a = document.createElement("a");
      a.href = "../../" + name;
      a.innerText = name;
      dd.appendChild(a);
      document.getElementById('other-versions-dl').appendChild(dd);
    }
    // Get versions.txt and add a version for each line
    fetch("../../versions.txt").then(response => {
      if (response.ok) {
        document.getElementById('other-versions-div').style.visibility = "visible";
        return response.text().then(text => text.split(/\r?\n/).forEach(addVersion))
      }
    });
  </script>


</body>
</html>